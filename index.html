<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Comentários Localhost</title>
    <style>
        body { font-family: sans-serif; max-width: 500px; margin: 40px auto; background: #f4f4f9; padding: 20px; }
        .container { background: white; padding: 20px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        input, textarea { width: 100%; padding: 10px; margin: 5px 0 15px 0; border: 1px solid #ddd; border-radius: 5px; box-sizing: border-box; }
        button { width: 100%; padding: 10px; background: #28a745; color: white; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; }
        .card { border-bottom: 1px solid #eee; padding: 15px 0; }
        .card:last-child { border: none; }
        .info { font-size: 12px; color: #888; margin-bottom: 5px; }
        .author { font-weight: bold; color: #333; margin-right: 10px; }
    </style>
</head>
<body>
    <div class="container">
        <h2>Novo Comentário</h2>
        <input type="text" id="author" placeholder="Seu nome">
        <textarea id="content" placeholder="Sua mensagem"></textarea>
        <button onclick="enviar()">Enviar Mensagem</button>

        <h3 style="margin-top: 30px;">Mensagens Recentes</h3>
        <div id="lista"></div>
    </div>

    <script>
        const API = '/comments/';

        async function carregar() {
            try {
                const res = await fetch(API);
                const dados = await res.json();
                const lista = document.getElementById('lista');
                lista.innerHTML = '';

                dados.reverse().forEach(c => { // reverse() para o mais novo aparecer no topo
                    const data = new Date(c.created_at).toLocaleTimeString('pt-BR', {hour: '2-digit', minute:'2-digit'});
                    lista.innerHTML += `
                        <div class="card">
                            <div class="info">
                                <span class="author">${c.author}</span>
                                <span>às ${data}</span>
                            </div>
                            <p style="margin: 0; color: #555;">${c.content}</p>
                        </div>`;
                });
            } catch (e) { console.error("Erro ao carregar:", e); }
        }

        async function enviar() {
            const payload = {
                author: document.getElementById('author').value,
                content: document.getElementById('content').value
            };

            if(!payload.author || !payload.content) return alert("Preencha tudo!");

            await fetch(API, {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify(payload)
            });

            document.getElementById('content').value = '';
            carregar();
        }

        // Carrega as mensagens assim que a página abre
        carregar();
    </script>
</body>
</html>